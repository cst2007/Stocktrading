Top 10 Detail
=============

This section documents the end-to-end logic for populating the "Top 5 Detail" block that feeds the trading model. The process now starts with the top ten strikes (while keeping the legacy "Top5" naming in the output schema) and is divided into four stages: extract, classify, prioritize, and output.

‚≠ê STAGE 1 ‚Äî EXTRACT
Input Fields (per strike)

Load the following fields for each strike:
- Strike
- Call_Volume
- Put_Volume
- Call_OI
- Put_OI
- Energy_Score
- Regime
- Dealer_Bias
- Distance_To_Spot

Computation ‚Äî Activity Score
```
Activity_Score =
    if (Call_Volume + Put_Volume) > 0:
        Call_Volume + Put_Volume
    else:
        Call_OI + Put_OI
```

Selection ‚Äî Top 10
- Sort all strikes by `Activity_Score` in descending order.
- `Top10_Strikes` are the first ten strikes in the sorted list.

Output of Stage 1
```
Top10 = [
    {Strike, Energy_Score, Regime, Dealer_Bias, Distance_To_Spot},
    ... 10 total records ...
]
```

‚≠ê STAGE 2 ‚Äî CLASSIFY

For each of the top ten strikes (or fewer if less data is available), assign a classification tag using the following logic:

1. **Fade Zone**
   - `Energy_Score == "High"`
   - `Regime` is `Gamma Pin` **or** `Vol Drift Down`
   - `Dealer_Bias` is `Bearish Fade` **or** `Neutral`
   - ‚Üí `Classification = "Fade_Zone"`

2. **Long Drift Zone**
   - `Energy_Score == "High"`
   - `Regime == "Vol Drift Up"`
   - `Dealer_Bias == "Bullish Drift"`
   - ‚Üí `Classification = "Long_Drift_Zone"`

3. **Short Drift Zone**
   - `Energy_Score == "High"`
   - `Regime == "Vol Drift Down"`
   - `Dealer_Bias == "Bearish Fade"`
   - ‚Üí `Classification = "Short_Drift_Zone"`

4. **Flip Zone**
   - `Regime == "Transition"`
   - `Energy_Score == "High"` **or** `Energy_Score == "Moderate"`
   - ‚Üí `Classification = "Flip_Zone"`

5. **Magnet Strike**
   - If `Energy_Score == "High"`, append `"Magnet"` to the `Classification` list (can be combined with the other tags above).

Output of Stage 2
```
Top10_Classified = [
    {Strike, Classification, Energy_Score, Regime, Dealer_Bias, Distance_To_Spot},
    ...
]
```

‚≠ê STAGE 3 ‚Äî PRIORITIZE

From `Top10_Classified`, pick the primary levels and magnet targets.

1. **Primary Fade Level**
   - Strikes where `Classification == "Fade_Zone"`.
   - Choose the strike with the smallest positive `Distance_To_Spot` (nearest above spot).

2. **Primary Long Drift Level**
   - Strikes where `Classification == "Long_Drift_Zone"`.
   - Choose the strike with the smallest positive `Distance_To_Spot` (nearest above), or if none exist, the smallest negative `Distance_To_Spot` (nearest below).

3. **Primary Short Drift Level**
   - Strikes where `Classification == "Short_Drift_Zone"`.
   - Choose the strike with the smallest positive `Distance_To_Spot`.

4. **Flip Zone**
   - Strikes where `Classification == "Flip_Zone"`.
   - Choose the strike with the smallest absolute `Distance_To_Spot`.

5. **Magnet Targets**
   - All strikes where `Classification` contains `"Magnet"`, sorted by `Distance_To_Spot` ascending.
   - `Nearest_Magnet` is the first element; `Secondary_Magnet` is the second element if it exists.

‚≠ê STAGE 4 ‚Äî OUTPUT (Trading Model Results)

Write the final result block in the following structure, using `null` when no qualifying strike exists:
```
{
  "Primary_Fade_Level": <strike or null>,
  "Primary_Long_Drift_Level": <strike or null>,
  "Primary_Short_Drift_Level": <strike or null>,
  "Flip_Zone": <strike or null>,

  "Nearest_Magnet": <strike>,
  "Secondary_Magnet": <strike or null>,

  "Top5_Detail": [  # legacy field name; contains up to 10 strikes
      {
        "Strike": ...,
        "Classification": ...,
        "Regime": ...,
        "Energy_Score": ...,
        "Dealer_Bias": ...,
        "Distance_To_Spot": ...
      },
      ...
  ]
}
```

üìå 1. Primary Fade Level

Use for shorts if above spot

Use for longs if below spot

Most reliable level for rejections

üìå 2. Primary Long Drift Continuation Level

If price touches this ‚Üí consider long continuation

Combine with VEX_dir > 0 and positive dGEX/dSpot

üìå 3. Primary Short Drift Continuation Level

If price touches this ‚Üí consider short continuation

Combine with VEX_dir < 0 and negative dGEX/dSpot

üìå 4. Flip Zone

Enter only after breakout confirmation

This level becomes the breakout or rejection pivot

High probability for regime shift

üìå 5. Magnet Targets

Output:

Nearest Magnet

Secondary Magnet

Extended Magnet

Used for:

Mean reversion

Breakout targets

Stop placement

Take-profit planning

üìå 6. Best Adam Setup Level

This is determined by:

Strong High-Energy strike

Regime supports trend

VEX_dir matches direction

dGEX/dSpot supports breakout or rejection

Spot in correct Gamma Box zone

Example:

If spot is below a High-Energy + Vol Drift Up strike ‚Üí Long Adam available.
If spot is above a High-Energy + Vol Drift Down strike ‚Üí Short Adam available.
